<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯ - Ù†Ø¸Ø§Ù… OMA</title>
<style>
:root {
  --primary: #004aad;
  --accent: #ffcc33;
  --bg: #f5f9ff;
  --card: #fff;
}

body {
  font-family: 'Cairo', sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 0;
}

header {
  background-color: var(--primary);
  color: white;
  text-align: center;
  padding: 15px 0;
  font-size: 20px;
  font-weight: bold;
}

.container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  padding: 40px;
  justify-content: center;
}

.card {
  background: var(--card);
  padding: 30px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  transition: 0.3s;
  cursor: pointer;
}

.card:hover {
  transform: translateY(-5px);
  background: #eef4ff;
}

.card h3 {
  color: var(--primary);
}

#logoutBtn {
  background-color: #d32f2f;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  transition: 0.3s;
  display: block;
  margin: 30px auto;
}

#logoutBtn:hover {
  background-color: #b71c1c;
}
</style>
</head>
<body>
<header>ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯</header>

<div class="container">
  <div class="card" id="studentsCard"><h3>ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3></div>
  <div class="card" id="teachersCard"><h3>ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h3></div>
  <div class="card" id="classesCard"><h3>ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ØµØµ</h3></div>
  <div class="card" id="attendanceCard"><h3>ğŸ•“ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h3></div>
  <div class="card" id="settingsCard"><h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3></div>
  <div class="card" id="financeCard"><h3>ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ</h3></div>
</div>

<button id="logoutBtn">ğŸ”“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

// ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAMANgdrLgoGIjqLZOcS_qyEqCUOVC7gOU",
  authDomain: "oma0-33cc0.firebaseapp.com",
  projectId: "oma0-33cc0",
  storageBucket: "oma0-33cc0.firebasestorage.app",
  messagingSenderId: "899300774863",
  appId: "1:899300774863:web:0a81a7f5747ef37d49b8ba",
  measurementId: "G-5CKWYQT9XZ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let instituteId = null; // Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±

// âœ… Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  const userDoc = await getDoc(doc(db, "users", user.uid));
  if (!userDoc.exists()) {
    alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!");
    await signOut(auth);
    window.location.href = "login.html";
    return;
  }

  const userData = userDoc.data();
  if (userData.type !== "instituteAdmin") {
    alert("Ù„Ø§ ÙŠØ­Ù‚ Ù„Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯!");
    await signOut(auth);
    window.location.href = "login.html";
    return;
  }

  instituteId = userData.instituteId; // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø¯ÙŠØ±

  // ØªØ­Ù…ÙŠÙ„ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯
  const instituteDoc = await getDoc(doc(db, "institutes", instituteId));
  if (instituteDoc.exists()) {
    const colors = instituteDoc.data().colors || {};
    if (colors.primary) document.documentElement.style.setProperty('--primary', colors.primary);
    if (colors.accent) document.documentElement.style.setProperty('--accent', colors.accent);
    if (colors.bg) document.documentElement.style.setProperty('--bg', colors.bg);
    if (colors.card) document.documentElement.style.setProperty('--card', colors.card);
  }
});

// ğŸ”˜ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¹Ù‡Ø¯
const pageLinks = {
  studentsCard: "students.html",
  teachersCard: "teachers.html",
  classesCard: "classes.html",
  attendanceCard: "attendance.html",
  settingsCard: "settings.html",
  financeCard: "finance.html"
};

Object.keys(pageLinks).forEach(id => {
  const el = document.getElementById(id);
  if (el) {
    el.addEventListener("click", () => {
      if(!instituteId){
        alert("Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...");
        return;
      }
      // ØªÙ…Ø±ÙŠØ± instituteId Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©
      window.location.href = pageLinks[id] + "?instituteId=" + instituteId;
    });
  }
});

// ğŸ”’ Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
document.getElementById("logoutBtn").addEventListener("click", async () => {
  await signOut(auth);
  alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­");
  window.location.href = "login.html";
});
</script>
</body>
</html>