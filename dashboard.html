<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù†Ø¸Ø§Ù… OMA</title>
<style>
:root {
  --primary: #004aad;
  --bg: #f5f9ff;
  --card: #fff;
  --accent: #ffcc33;
}

body {
  font-family: 'Cairo', sans-serif;
  background: var(--bg);
  margin: 0;
  padding: 0;
}

header {
  background-color: var(--primary);
  color: white;
  text-align: center;
  padding: 15px 0;
  font-size: 20px;
  font-weight: bold;
}

.container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  padding: 40px;
  justify-content: center;
}

.card {
  background: var(--card);
  padding: 30px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  transition: 0.3s;
  cursor: pointer;
}

.card:hover {
  transform: translateY(-5px);
  background: var(--accent);
  color: white;
}

.card h3 { color: var(--primary); }

#logoutBtn {
  background-color: #d32f2f;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  transition: 0.3s;
  display: block;
  margin: 30px auto;
}
#logoutBtn:hover { background-color: #b71c1c; }
#instituteLogo { max-height: 60px; display: block; margin: 0 auto 10px; border-radius: 6px; }
</style>
</head>
<body>

<header id="dashboardHeader">ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</header>
<img id="instituteLogo" src="" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹Ù‡Ø¯" />

<div class="container">
  <div class="card" id="studentsCard"><h3>ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3></div>
  <div class="card" id="teachersCard"><h3>ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h3></div>
  <div class="card" id="classesCard"><h3>ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ØµØµ</h3></div>
  <div class="card" id="attendanceCard"><h3>ğŸ•“ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h3></div>
  <div class="card" id="settingsCard"><h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3></div>
  <div class="card" id="financeCard"><h3>ğŸ’° Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ</h3></div>
</div>

<button id="logoutBtn">ğŸ”“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

// ğŸ”¹ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAMANgdrLgoGIjqLZOcS_qyEqCUOVC7gOU",
  authDomain: "oma0-33cc0.firebaseapp.com",
  projectId: "oma0-33cc0",
  storageBucket: "oma0-33cc0.firebasestorage.app",
  messagingSenderId: "899300774863",
  appId: "1:899300774863:web:0a81a7f5747ef37d49b8ba",
  measurementId: "G-5CKWYQT9XZ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const dashboardHeader = document.getElementById("dashboardHeader");
const instituteLogoEl = document.getElementById("instituteLogo");

// ğŸ”˜ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
const pageLinks = {
  studentsCard: "students.html",
  teachersCard: "teachers.html",
  classesCard: "classes.html",
  attendanceCard: "attendance.html",
  settingsCard: "settings.html",
  financeCard: "finance.html"
};

Object.keys(pageLinks).forEach(id => {
  const el = document.getElementById(id);
  if(el) el.addEventListener("click", ()=> window.location.href = pageLinks[id]);
});

// ğŸ”’ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  await signOut(auth);
  window.location.href = "login.html";
});

// âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯
onAuthStateChanged(auth, async user => {
  if(!user){
    window.location.href = "login.html";
    return;
  }

  try{
    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† users collection
    const userDoc = await getDoc(doc(db, "users", user.uid));
    if(!userDoc.exists()){
      alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….");
      await signOut(auth);
      window.location.href = "login.html";
      return;
    }

    const userData = userDoc.data();
    const instituteId = userData.instituteId;
    if(!instituteId){
      alert("Ù„Ù… ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø£ÙŠ Ù…Ø¹Ù‡Ø¯.");
      await signOut(auth);
      window.location.href = "login.html";
      return;
    }

    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯
    const instituteDoc = await getDoc(doc(db, "institutes", instituteId));
    if(!instituteDoc.exists()){
      alert("Ø§Ù„Ù…Ø¹Ù‡Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");
      await signOut(auth);
      window.location.href = "login.html";
      return;
    }

    const inst = instituteDoc.data();

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
    if(inst.colors){
      if(inst.colors.primary) document.documentElement.style.setProperty('--primary', inst.colors.primary);
      if(inst.colors.bg) document.documentElement.style.setProperty('--bg', inst.colors.bg);
      if(inst.colors.card) document.documentElement.style.setProperty('--card', inst.colors.card);
      if(inst.colors.accent) document.documentElement.style.setProperty('--accent', inst.colors.accent);
    }

    // Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù‡Ø¯
    dashboardHeader.textContent = `ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ${inst.name || "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"}`;

    // Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹Ù‡Ø¯
    if(inst.logoUrl){
      instituteLogoEl.src = inst.logoUrl;
      instituteLogoEl.style.display = "block";
    } else {
      instituteLogoEl.style.display = "none";
    }

  }catch(err){
    console.error(err);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯: " + err.message);
    await signOut(auth);
    window.location.href = "login.html";
  }
});
</script>

</body>
</html>