<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… OMA - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
<style>
:root{
  --primary:#004aad;
  --accent:#ffcc33;
  --bg:#f5f9ff;
  --card:#fff;
}
body{font-family:'Cairo',sans-serif;margin:0;background:var(--bg);color:#102027;direction:rtl;}
header{background:linear-gradient(90deg,var(--primary),#007bff);color:#fff;padding:18px;text-align:center;font-size:20px;font-weight:700;box-shadow:0 3px 12px rgba(2,20,40,0.08);}
.wrap{max-width:1200px;margin:20px auto;padding:12px;}
.card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(6,20,30,0.06);margin-bottom:16px;}
h2{margin-top:0;color:var(--primary);}
button{cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:12px;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;font-size:14px;}
th{background:var(--primary);color:#fff;}
.actions button{margin:0 6px;}
.btn{background:var(--primary);color:#fff;padding:8px 12px;border:none;border-radius:8px;font-weight:700;}
.btn.warn{background:#ff7043;}
.btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(0,74,173,0.12);}
@media print{
  body{background:white;padding:0;}
  header,.card .controls,.actions,.filters,.modal{display:none !important;}
  .print-page{box-shadow:none;margin:0;padding:0;}
}
.modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:9999;}
.modal.open{display:flex;}
.modal .box{background:white;padding:18px;border-radius:10px;max-width:720px;width:94%;max-height:90vh;overflow:auto;}
.flex{display:flex;gap:8px;align-items:center;}
</style>
</head>
<body>
<header>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… OMA - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</header>
<div class="wrap">

<!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ -->
<div class="card" id="studentsSection">
  <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
  <div class="controls">
    <button id="addStudentBtn" class="btn">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
    <button id="printStudentsBtn" class="btn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
  </div>
  <table id="studentsTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
        <th>Ø§Ù„Ù…ÙˆØ§Ø¯</th>
        <th>Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</th>
        <th>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© -->
<div class="card" id="teachersSection">
  <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h2>
  <div class="controls">
    <button id="addTeacherBtn" class="btn">â• Ø¥Ø¶Ø§ÙØ© Ø£Ø³ØªØ§Ø° Ø¬Ø¯ÙŠØ¯</button>
    <button id="printTeachersBtn" class="btn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</button>
  </div>
  <table id="teachersTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ù…ÙˆØ§Ø¯</th>
        <th>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</th>
        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
        <th>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ØµØµ -->
<div class="card" id="classesSection">
  <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­ØµØµ ÙˆØ§Ù„Ø¯Ø±ÙˆØ³</h2>
  <div class="controls">
    <button id="addClassBtn" class="btn">â• Ø¥Ø¶Ø§ÙØ© Ø­ØµØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
  </div>
  <table id="classesTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
        <th>Ø§Ù„Ø£Ø³ØªØ§Ø°</th>
        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
        <th>Ø§Ù„ÙŠÙˆÙ… / Ø§Ù„ÙˆÙ‚Øª</th>
        <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
        <th>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="box">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <strong id="modalTitle">ØªÙØ§ØµÙŠÙ„</strong>
      <button id="closeModal" class="btn ghost">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ================== Ø§Ù„Ø·Ù„Ø§Ø¨ ==================
const studentsTableBody = document.querySelector("#studentsTable tbody");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨
async function loadStudents(){
  const snapshot = await getDocs(collection(db,"students"));
  studentsTableBody.innerHTML="";
  snapshot.forEach(docSnap=>{
    const student = {...docSnap.data(),id:docSnap.id};
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${student.name}</td>
      <td>${student.phone}</td>
      <td>${student.group}</td>
      <td>${student.subjects.map(s=>s.name).join(", ")}</td>
      <td>${student.subjects.map(s=>"Ø¥Ø¬Ù…Ø§Ù„ÙŠ:"+s.fee+" / Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:"+s.remaining).join("<br>")}</td>
      <td class="actions">
        <button class="btn small" onclick="showStudent('${student.id}')">ğŸ” Ø¹Ø±Ø¶</button>
        <button class="btn warn small" onclick="deleteStudent('${student.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </td>
    `;
    studentsTableBody.appendChild(tr);
  });
}
loadStudents();

// Ø­Ø°Ù Ø·Ø§Ù„Ø¨
async function deleteStudent(id){
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ")){
    await deleteDoc(doc(db,"students",id));
    loadStudents();
  }
}

// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨
function showStudent(id){
  const snapshot = studentsTableBody.querySelectorAll("tr");
  const studentRow = Array.from(snapshot).find(tr=>tr.querySelector(".actions button").getAttribute("onclick").includes(id));
  document.getElementById("modalBody").innerHTML = studentRow.innerHTML;
  document.getElementById("modal").classList.add("open");
}
document.getElementById("closeModal").addEventListener("click",()=>{document.getElementById("modal").classList.remove("open")});

// Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
document.getElementById("printStudentsBtn").addEventListener("click",()=>{window.print();});

</script>
</body>
</html>
