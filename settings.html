<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†Ø¸Ø§Ù… OMA - Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
<style>
:root{
  --primary:#004aad;
  --accent:#ffcc33;
  --bg:#f5f9ff;
  --card:#fff;
}
body{font-family:'Cairo',sans-serif;direction:rtl;margin:0;background:var(--bg);color:#102027;visibility:hidden;}
header{background:var(--primary);color:#fff;padding:18px;text-align:center;font-size:20px;font-weight:700;}
.wrap{max-width:1200px;margin:22px auto;padding:12px;}
.card{background:var(--card);border-radius:10px;padding:14px;margin-bottom:16px;box-shadow:0 6px 18px rgba(6,20,30,0.06);}
input, select{padding:10px;border:1px solid #d6dde9;border-radius:8px;font-size:15px;width:100%;margin-bottom:8px;}
label{display:block;margin-bottom:6px;font-size:13px;color:#37474f;}
.btn{background:var(--primary);color:#fff;padding:10px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:700;margin-bottom:8px;}
.btn.warn{background:#ff7043;}
table{width:100%;border-collapse:collapse;margin-top:12px;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;font-size:14px;}
th{background:var(--primary);color:#fff;}
.filters{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;}
.filters select{flex:1;}
</style>
</head>
<body>
<header>Ù†Ø¸Ø§Ù… OMA - Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</header>
<div class="wrap">

<!-- Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… -->
<div class="card">
  <strong>Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</strong>
  <form id="userForm">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
    <select id="userType">
      <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</option>
      <option value="student">Ø·Ø§Ù„Ø¨</option>
      <option value="teacher">Ø£Ø³ØªØ§Ø°</option>
      <option value="admin">Ù…Ø¯ÙŠØ±/Ù…Ø­Ø§Ø³Ø¨</option>
    </select>

    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
    <select id="userName" required>
      <option value="">Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
    </select>

    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input id="userEmail" type="email" required>

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="userPassword" type="password" required>

    <button type="submit" class="btn">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
  </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

// âš¡ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ğŸ”’ Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
onAuthStateChanged(auth,user=>{
  if(!user) window.location.href="login.html";
  else document.body.style.visibility="visible";
});

const userTypeSelect = document.getElementById("userType");
const userNameSelect = document.getElementById("userName");

let studentsData = [];
let teachersData = [];

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø£Ø³Ø§ØªØ°Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§
async function loadData(){
  const studentsSnap = await getDocs(collection(db,"students"));
  studentsData = studentsSnap.docs.map(doc=>({...doc.data(),id:doc.id}));

  const teachersSnap = await getDocs(collection(db,"teachers"));
  teachersData = teachersSnap.docs.map(doc=>({...doc.data(),id:doc.id}));
}
await loadData();

// ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø³Ù…Ø§Ø¡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨
userTypeSelect.addEventListener("change",()=>{
  const type = userTypeSelect.value;
  userNameSelect.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>";
  if(type==="student"){
    studentsData.forEach(s=>userNameSelect.innerHTML+=`<option value="${s.id}">${s.name} - ${s.group} - ${s.stage}</option>`);
  }else if(type==="teacher"){
    teachersData.forEach(t=>userNameSelect.innerHTML+=`<option value="${t.id}">${t.name}</option>`);
  }
});

// Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
document.getElementById("userForm").addEventListener("submit",async(e)=>{
  e.preventDefault();
  const type = userTypeSelect.value;
  const selectedId = userNameSelect.value;
  const email = document.getElementById("userEmail").value.trim();
  const password = document.getElementById("userPassword").value.trim();

  if(!type || !selectedId || !email || !password){alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); return;}

  // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®Øµ Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ Ø£Ùˆ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
  let userData = {};
  if(type==="student") userData = studentsData.find(s=>s.id===selectedId);
  else if(type==="teacher") userData = teachersData.find(t=>t.id===selectedId);

  try{
    const cred = await createUserWithEmailAndPassword(auth,email,password);
    await addDoc(collection(db,"users"),{
      uid: cred.user.uid,
      type,
      linkedId:selectedId,
      name:userData.name,
      email,
      createdAt:new Date()
    });
    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­");
    document.getElementById("userForm").reset();
    userNameSelect.innerHTML="<option value=''>Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>";
  }catch(err){console.error(err);alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡")}
});
</script>
</body>
</html>