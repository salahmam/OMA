<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯ - Firestore</title>
<style>
body { font-family: 'Cairo', sans-serif; background: #f5f9ff; color: #102027; padding: 20px; direction: rtl; }
.card { background: #fff; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
input, select, button { padding: 10px; margin-bottom: 10px; border-radius: 8px; font-size: 15px; width: 100%; }
button { background: #004aad; color: #fff; border: none; font-weight: bold; cursor: pointer; }
button:hover { background: #003a8c; }
label { font-size: 14px; display:block; margin-bottom:5px; }
.social-icons img { height:28px; margin-left:5px; cursor:pointer; }
</style>
</head>
<body>

<h2>ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯</h2>

<div class="card">
  <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯</strong>
  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù‡Ø¯</label>
  <input type="text" id="instituteName">
  <label>Ø§Ù„Ø´Ø¹Ø§Ø± (Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©)</label>
  <input type="text" id="instituteLogo">
  <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
  <input type="text" id="instituteAddress">
  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
  <input type="text" id="institutePhone">
  <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
  <input type="email" id="instituteEmail">
  <button id="saveInstituteBtn">ğŸ’¾ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯</button>
</div>

<div class="card">
  <strong>ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</strong>
  <label>ÙÙŠØ³Ø¨ÙˆÙƒ</label><input type="text" id="facebookLink">
  <label>Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</label><input type="text" id="instagramLink">
  <label>ØªÙŠÙƒ ØªÙˆÙƒ</label><input type="text" id="tiktokLink">
  <label>ØªÙ„ÙŠØ¬Ø±Ø§Ù…</label><input type="text" id="telegramLink">
  <button id="saveSocialBtn">ğŸ’¾ Ø­ÙØ¸ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„</button>
</div>

<div class="card">
  <strong>ØªØ®ØµÙŠØµ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø¹Ù‡Ø¯</strong>
  <label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label><input type="color" id="primaryColor">
  <label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</label><input type="color" id="accentColor">
  <button id="saveColorsBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</button>
</div>

<div class="card">
  <strong>Ù†Ø³Ø¨ Ø§Ù„Ø£Ø³ØªØ§Ø° ÙˆØ§Ù„Ù…Ø¹Ù‡Ø¯</strong>
  <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° (%)</label><input type="number" id="teacherPercent" min="0" max="100">
  <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ù‡Ø¯ (%)</label><input type="number" id="institutePercent" min="0" max="100">
  <button id="savePercentBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨</button>
</div>

<div class="card">
  <strong>Ø§Ù„ÙØ±ÙˆØ¹</strong>
  <label>Ø£Ø¶Ù ÙØ±Ø¹ Ø¬Ø¯ÙŠØ¯</label><input type="text" id="newBranch">
  <button id="addBranchBtn">â• Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹</button>
  <ul id="branchesList"></ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, getDocs, deleteDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAMANgdrLgoGIjqLZOcS_qyEqCUOVC7gOU",
  authDomain: "oma0-33cc0.firebaseapp.com",
  projectId: "oma0-33cc0",
  storageBucket: "oma0-33cc0.firebasestorage.app",
  messagingSenderId: "899300774863",
  appId: "1:899300774863:web:0a81a7f5747ef37d49b8ba",
  measurementId: "G-5CKWYQT9XZ"
};
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);
const auth = getAuth(app);

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
onAuthStateChanged(auth,user=>{
  if(!user){ alert("âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"); window.location.href="login.html";}
});

// --- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© ---
const instituteName = document.getElementById("instituteName");
const instituteLogo = document.getElementById("instituteLogo");
const instituteAddress = document.getElementById("instituteAddress");
const institutePhone = document.getElementById("institutePhone");
const instituteEmail = document.getElementById("instituteEmail");
const facebookLink = document.getElementById("facebookLink");
const instagramLink = document.getElementById("instagramLink");
const tiktokLink = document.getElementById("tiktokLink");
const telegramLink = document.getElementById("telegramLink");
const primaryColor = document.getElementById("primaryColor");
const accentColor = document.getElementById("accentColor");
const teacherPercent = document.getElementById("teacherPercent");
const institutePercent = document.getElementById("institutePercent");
const newBranch = document.getElementById("newBranch");
const branchesList = document.getElementById("branchesList");

// --- Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯ ---
document.getElementById("saveInstituteBtn").addEventListener("click", async()=>{
  await setDoc(doc(db,"settings","institute"),{
    name: instituteName.value,
    logo: instituteLogo.value,
    address: instituteAddress.value,
    phone: institutePhone.value,
    email: instituteEmail.value
  });
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ù‡Ø¯");
});

// --- Ø­ÙØ¸ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ ---
document.getElementById("saveSocialBtn").addEventListener("click", async()=>{
  await setDoc(doc(db,"settings","social"),{
    facebook: facebookLink.value,
    instagram: instagramLink.value,
    tiktok: tiktokLink.value,
    telegram: telegramLink.value
  });
  alert("âœ… ØªÙ… Ø­ÙØ¸ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„");
});

// --- Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ---
document.getElementById("saveColorsBtn").addEventListener("click", async()=>{
  await setDoc(doc(db,"settings","colors"),{
    primary: primaryColor.value,
    accent: accentColor.value
  });
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ù„ÙˆØ§Ù†");
});

// --- Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨ ---
document.getElementById("savePercentBtn").addEventListener("click", async()=>{
  const t = parseFloat(teacherPercent.value) || 0;
  const i = parseFloat(institutePercent.value) || 0;
  if(t+i!==100){ alert("Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ø³Ø¨ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 100%"); return; }
  await setDoc(doc(db,"settings","percentages"),{teacher:t,institute:i});
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø¨");
});

// --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±ÙˆØ¹ ---
async function loadBranches(){
  branchesList.innerHTML="";
  const docSnap = await getDoc(doc(db,"settings","branches"));
  if(docSnap.exists()){
    const data = docSnap.data();
    if(data.list) data.list.forEach(b=>{
      const li = document.createElement("li");
      li.textContent = b;
      const btn = document.createElement("button");
      btn.textContent="ğŸ—‘ï¸";
      btn.style.marginLeft="10px";
      btn.onclick = async()=>{
        await updateDoc(doc(db,"settings","branches"),{list:arrayRemove(b)});
        loadBranches();
      };
      li.appendChild(btn);
      branchesList.appendChild(li);
    });
  }
}
document.getElementById("addBranchBtn").addEventListener("click", async()=>{
  const name = newBranch.value.trim();
  if(!name) return;
  await updateDoc(doc(db,"settings","branches"),{list:arrayUnion(name)}).catch(async()=>{
    await setDoc(doc(db,"settings","branches"),{list:[name]});
  });
  newBranch.value="";
  loadBranches();
});

// --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ---
async function loadSettings(){
  const inst = await getDoc(doc(db,"settings","institute"));
  if(inst.exists()){ Object.assign({name:instituteName.value,logo:instituteLogo.value,address:instituteAddress.value,phone:institutePhone.value,email:instituteEmail.value},inst.data()); instituteName.value=inst.data().name; instituteLogo.value=inst.data().logo; instituteAddress.value=inst.data().address; institutePhone.value=inst.data().phone; instituteEmail.value=inst.data().email; }
  const social = await getDoc(doc(db,"settings","social"));
  if(social.exists()){ facebookLink.value=social.data().facebook; instagramLink.value=social.data().instagram; tiktokLink.value=social.data().tiktok; telegramLink.value=social.data().telegram; }
  const colors = await getDoc(doc(db,"settings","colors"));
  if(colors.exists()){ primaryColor.value=colors.data().primary; accentColor.value=colors.data().accent; document.documentElement.style.setProperty("--primary",colors.data().primary); document.documentElement.style.setProperty("--accent",colors.data().accent);}
  const perc = await getDoc(doc(db,"settings","percentages"));
  if(perc.exists()){ teacherPercent.value=perc.data().teacher; institutePercent.value=perc.data().institute; }
  loadBranches();
}
loadSettings();
</script>

</body>
</html>