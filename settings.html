<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ù†Ø¸Ø§Ù… OMA</title>
<style>
:root{
  --primary:#004aad;
  --accent:#ffcc33;
  --bg:#f5f9ff;
  --card:#fff;
}
*{box-sizing:border-box}
body{
  font-family:'Cairo',sans-serif;
  background:linear-gradient(180deg,var(--bg),#fff);
  margin:0;direction:rtl;
  visibility:hidden;
}
header{
  background:linear-gradient(90deg,var(--primary),#007bff);
  color:white;
  padding:18px;
  text-align:center;
  font-size:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header button{
  background:#ff5555;
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}
.wrap{max-width:800px;margin:30px auto;padding:16px}
.card{
  background:var(--card);
  border-radius:10px;
  padding:16px;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
}
label{display:block;margin-bottom:4px;font-size:13px}
input,textarea{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:15px;
}
textarea{resize:none;height:70px}
.btn{
  background:var(--primary);
  color:white;
  padding:10px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>
<body>
<header>
  Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
  <button id="logoutBtn">ğŸ”“ Ø®Ø±ÙˆØ¬</button>
</header>

<div class="wrap">
  <div class="card">
    <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
    <form id="settingsForm">
      <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù‡Ø¯</label>
      <input id="instituteName" required>

      <label>Ø§Ù„Ø´Ø¹Ø§Ø± (Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø©)</label>
      <input id="logoUrl">

      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input id="phone">

      <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
      <textarea id="address"></textarea>

      <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ</label>
      <input id="facebook">

      <label>Ø±Ø§Ø¨Ø· Ø¥Ù†Ø³ØªØºØ±Ø§Ù…</label>
      <input id="instagram">

      <label>Ø³Ù†Ø© Ø§Ù„ØªØ£Ø³ÙŠØ³</label>
      <input id="founded">

      <div style="text-align:end">
        <button type="submit" class="btn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      </div>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDt2HAOKr3iko8V-u392vh2R2my14km7ag",
  authDomain: "oma2-d36fa.firebaseapp.com",
  projectId: "oma2-d36fa",
  storageBucket: "oma2-d36fa.firebasestorage.app",
  messagingSenderId: "774171603105",
  appId: "1:774171603105:web:91f2a5f44c4dde684080e0",
  measurementId: "G-QHPZG4JLB8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
onAuthStateChanged(auth, async (user)=>{
  if(!user){
    window.location.href="login.html";
  } else {
    document.body.style.visibility="visible";
    await loadSettings();
  }
});

// Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  await signOut(auth);
  window.location.href="login.html";
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Firestore
async function loadSettings(){
  const ref = doc(db,"config","settings");
  const snap = await getDoc(ref);
  if(snap.exists()){
    const data = snap.data();
    document.getElementById("instituteName").value = data.instituteName || "";
    document.getElementById("logoUrl").value = data.logoUrl || "";
    document.getElementById("phone").value = data.phone || "";
    document.getElementById("address").value = data.address || "";
    document.getElementById("facebook").value = data.facebook || "";
    document.getElementById("instagram").value = data.instagram || "";
    document.getElementById("founded").value = data.founded || "";
  }
}

// Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
document.getElementById("settingsForm").addEventListener("submit", async(e)=>{
  e.preventDefault();

  const data = {
    instituteName: document.getElementById("instituteName").value,
    logoUrl: document.getElementById("logoUrl").value,
    phone: document.getElementById("phone").value,
    address: document.getElementById("address").value,
    facebook: document.getElementById("facebook").value,
    instagram: document.getElementById("instagram").value,
    founded: document.getElementById("founded").value
  };

  await setDoc(doc(db,"config","settings"), data);
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
});
</script>
</body>
</html>