<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†Ø¸Ø§Ù… OMA - Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
<style>
body{font-family:'Cairo',sans-serif;direction:rtl;margin:0;background:#f5f9ff;color:#102027;}
header{background:#004aad;color:#fff;padding:18px;text-align:center;font-size:20px;font-weight:700;}
.wrap{max-width:1200px;margin:22px auto;padding:12px;}
.card{background:#fff;border-radius:10px;padding:14px;margin-bottom:16px;box-shadow:0 6px 18px rgba(6,20,30,0.06);}
input, select{padding:10px;border:1px solid #d6dde9;border-radius:8px;font-size:15px;width:100%;margin-bottom:8px;}
label{display:block;margin-bottom:6px;font-size:13px;color:#37474f;}
.btn{background:#004aad;color:#fff;padding:10px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:700;margin-bottom:8px;}
.btn.warn{background:#ff7043;}
table{width:100%;border-collapse:collapse;margin-top:12px;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;font-size:14px;}
th{background:#004aad;color:#fff;}
@media print{
  body{background:white;}
  header,.btn,.modal{display:none !important;}
}
.filters{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;}
.filters select{flex:1;}
</style>
</head>
<body>
<header>Ù†Ø¸Ø§Ù… OMA - Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</header>
<div class="wrap">

<!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø¨ -->
<div class="card">
  <strong>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø¨</strong>
  <form id="settingsForm">
    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ù‡Ø¯ %</label>
    <input id="instituteShare" type="number" min="0" max="100">
    <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° %</label>
    <input id="teacherShare" type="number" min="0" max="100">
    <button type="submit" class="btn">âœ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </form>
</div>

<!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª -->
<div class="card">
  <strong>Ø¥Ø¯Ø§Ø±Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</strong>
  <form id="userForm">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
    <select id="userType">
      <option value="student">Ø·Ø§Ù„Ø¨</option>
      <option value="teacher">Ø£Ø³ØªØ§Ø°</option>
      <option value="admin">Ù…Ø¯ÙŠØ±/Ù…Ø­Ø§Ø³Ø¨</option>
    </select>
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
    <input id="userName" type="text" required>
    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
    <input id="userEmail" type="email" required>
    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input id="userPassword" type="password" required>
    <button type="submit" class="btn">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
  </form>
</div>

<!-- ÙÙ„Ø§ØªØ± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ -->
<div class="card">
  <strong>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</strong>
  <div class="filters">
    <select id="studentFilterGroup"><option value="">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙƒØ±ÙˆØ¨</option></select>
    <select id="studentFilterStage"><option value="">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</option></select>
  </div>
  <table id="studentsTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
        <th>Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</th>
        <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- ÙÙ„Ø§ØªØ± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© -->
<div class="card">
  <strong>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</strong>
  <div class="filters">
    <select id="teacherFilter"><option value="">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø³ØªØ§Ø°</option></select>
  </div>
  <table id="teachersTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>Ø§Ù„Ù…ÙˆØ§Ø¯</th>
        <th>Ø§Ù„Ù…Ø±Ø§Ø­Ù„</th>
        <th>Ø§Ù„ÙƒØ±ÙˆØ¨Ø§Øª</th>
        <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- ÙÙ„Ø§ØªØ± ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø­ØµØµ -->
<div class="card">
  <strong>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­ØµØµ</strong>
  <div class="filters">
    <select id="classFilterTeacher"><option value="">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø³ØªØ§Ø°</option></select>
    <select id="classFilterGroup"><option value="">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙƒØ±ÙˆØ¨</option></select>
  </div>
  <table id="classesTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
        <th>Ø§Ù„Ø£Ø³ØªØ§Ø°</th>
        <th>Ø§Ù„ÙƒØ±ÙˆØ¨</th>
        <th>Ø§Ù„ÙŠÙˆÙ…</th>
        <th>Ø§Ù„ÙˆÙ‚Øª</th>
        <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// ØªØ£Ù…ÙŠÙ† Ø§Ù„ØµÙØ­Ø©
auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="login.html";
});

// Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ù„Ø§Ø¨
const studentsTableBody = document.querySelector("#studentsTable tbody");
const studentFilterGroup = document.getElementById("studentFilterGroup");
const studentFilterStage = document.getElementById("studentFilterStage");

// Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
const teachersTableBody = document.querySelector("#teachersTable tbody");
const teacherFilter = document.getElementById("teacherFilter");

// Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­ØµØµ
const classesTableBody = document.querySelector("#classesTable tbody");
const classFilterTeacher = document.getElementById("classFilterTeacher");
const classFilterGroup = document.getElementById("classFilterGroup");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨
async function loadStudents(){
  const snapshot = await getDocs(collection(db,"students"));
  studentsTableBody.innerHTML="";
  let groupsSet = new Set(), stagesSet = new Set();
  snapshot.forEach(docSnap=>{
    const s = {...docSnap.data(),id:docSnap.id};
    // Ø­ÙØ¸ Ø§Ù„ÙÙ„Ø§ØªØ±
    groupsSet.add(s.group); stagesSet.add(s.stage);
    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td>${s.name}</td>
      <td>${s.phone}</td>
      <td>${s.stage}</td>
      <td>${s.group}</td>
      <td>${s.subjects.map(sub=>"["+sub.name+"-"+sub.fee+"]").join(", ")}</td>
      <td><button class="btn warn" onclick="deleteStudent('${s.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
    `;
    studentsTableBody.appendChild(tr);
  });
  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙÙ„Ø§ØªØ±
  studentFilterGroup.innerHTML="<option value=''>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙƒØ±ÙˆØ¨</option>"; groupsSet.forEach(g=>{studentFilterGroup.innerHTML+=`<option value='${g}'>${g}</option>`});
  studentFilterStage.innerHTML="<option value=''>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</option>"; stagesSet.forEach(st=>{studentFilterStage.innerHTML+=`<option value='${st}'>${st}</option>`});
}
loadStudents();

// Ø­Ø°Ù Ø·Ø§Ù„Ø¨
window.deleteStudent = async(id)=>{
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ")){
    await deleteDoc(doc(db,"students",id));
    loadStudents();
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
async function loadTeachers(){
  const snapshot = await getDocs(collection(db,"teachers"));
  teachersTableBody.innerHTML=""; teacherFilter.innerHTML="<option value=''>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø³ØªØ§Ø°</option>";
  snapshot.forEach(docSnap=>{
    const t = {...docSnap.data(),id:docSnap.id};
    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td>${t.name}</td>
      <td>${t.phone}</td>
      <td>${t.subjects.map(s=>s.name).join(", ")}</td>
      <td>${t.stages}</td>
      <td>${t.groups}</td>
      <td><button class="btn warn" onclick="deleteTeacher('${t.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
    `;
    teachersTableBody.appendChild(tr);
    teacherFilter.innerHTML+=`<option value='${t.name}'>${t.name}</option>`;
  });
}
loadTeachers();

// Ø­Ø°Ù Ø£Ø³ØªØ§Ø°
window.deleteTeacher = async(id)=>{
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø£Ø³ØªØ§Ø°ØŸ")){
    await deleteDoc(doc(db,"teachers",id));
    loadTeachers();
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­ØµØµ
async function loadClasses(){
  const snapshot = await getDocs(collection(db,"classes"));
  classesTableBody.innerHTML="";
  classFilterTeacher.innerHTML="<option value=''>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ø³ØªØ§Ø°</option>";
  classFilterGroup.innerHTML="<option value=''>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙƒØ±ÙˆØ¨</option>";
  snapshot.forEach(docSnap=>{
    const c = {...docSnap.data(),id:docSnap.id};
    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td>${c.subject}</td>
      <td>${c.teacherName}</td>
      <td>${c.group}</td>
      <td>${c.day}</td>
      <td>${c.time}</td>
      <td><button class="btn warn" onclick="deleteClass('${c.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button></td>
    `;
    classesTableBody.appendChild(tr);
    classFilterTeacher.innerHTML+=`<option value='${c.teacherName}'>${c.teacherName}</option>`;
    classFilterGroup.innerHTML+=`<option value='${c.group}'>${c.group}</option>`;
  });
}
loadClasses();

// Ø­Ø°Ù Ø­ØµØ©
window.deleteClass = async(id)=>{
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø­ØµØ©ØŸ")){
    await deleteDoc(doc(db,"classes",id));
    loadClasses();
  }
}
</script>
</body>
</html>