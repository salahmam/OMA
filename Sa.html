<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ØªØ·Ø¨ÙŠÙ‚ Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©  â€” Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸</title>
<style>
  :root{
    --bg:#f3f6fa;
    --card:#ffffff;
    --accent:#004aad;
    --muted:#6b7280;
    --node-border:#d1e4ff;
  }
  html,body{height:100%;margin:0;font-family: "Cairo", "Segoe UI", Tahoma, sans-serif;background:var(--bg);color:#0b1630}
  header{background:linear-gradient(90deg,var(--accent),#0066d6);color:white;padding:12px 18px;display:flex;gap:12px;align-items:center;justify-content:space-between}
  header h1{font-size:18px;margin:0}
  .container{display:flex;height:calc(100% - 60px)}
  .panel{width:320px;background:var(--card);box-shadow:0 2px 6px rgba(2,6,23,0.08);padding:14px;overflow:auto;border-left:4px solid var(--accent)}
  .panel h2{margin:0 0 8px 0;font-size:16px}
  .panel p.small{color:var(--muted);font-size:13px;margin:6px 0}
  .workspace{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:12px}
  .canvas-wrap{flex:1;background:linear-gradient(180deg,#eef6ff,transparent);border-radius:8px;overflow:hidden;position:relative;border:1px dashed rgba(0,0,0,0.04)}
  /* toolbar */
  .toolbar{display:flex;gap:8px;margin-bottom:10px;align-items:center}
  .toolbar button, .panel button{background:var(--accent);color:white;border:none;padding:8px 10px;border-radius:6px;cursor:pointer}
  .toolbar .muted{background:#e6eefb;color:var(--accent)}
  .input-row{display:flex;gap:8px;margin:8px 0}
  .input-row input[type="text"], .input-row input[type="number"]{flex:1;padding:8px;border:1px solid #d6e4ff;border-radius:6px}
  .small-btn{padding:6px 8px;font-size:14px}
  .muted-plain{background:#f1f5f9;color:#0b1630;border:1px solid #e6eefb}
  /* tree style: center horizontally */
  #tree-container{width:2000px;height:1600px;transform-origin:0 0;transition:transform .08s linear}
  .tree-root{display:flex;justify-content:center;padding:20px 0}
  .node{display:flex;flex-direction:column;align-items:center;min-width:120px;position:relative}
  .node-card{
    background:var(--card);border:1px solid var(--node-border);padding:8px 10px;border-radius:10px;box-shadow:0 2px 6px rgba(2,6,23,0.04);min-width:100px;text-align:center
  }
  .node-card .name{font-weight:700;margin-bottom:6px}
  .node-actions{display:flex;gap:6px;font-size:13px}
  .node-actions button{background:#fff;border:1px solid #e6eefb;padding:4px 6px;border-radius:6px;cursor:pointer}
  .children{display:flex;gap:18px;margin-top:18px;align-items:flex-start;justify-content:center}
  /* lines between parent and children */
  .children::before{
    content:"";position:absolute;left:50%;top:calc(50% + 28px);transform:translateX(-50%);width:2px;height:18px;background:transparent;
  }
  /* connecting lines */
  .connector-vertical{position:absolute;height:18px;width:2px;background:rgba(0,74,173,0.12);left:50%;top:calc(100% + 6px);transform:translateX(-50%);z-index:0}
  .connector-horizontal{position:absolute;height:2px;background:rgba(0,74,173,0.12);top:-6px;left:0;right:0;margin:auto;width:80%;z-index:0}
  /* responsive */
  @media (max-width:900px){
    .panel{display:none}
  }
  /* small tips */
  .hint{font-size:13px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<header>
  <h1>ØªØ·Ø¨ÙŠÙ‚ Ø´Ø¬Ø±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© â€” ØªÙØ§Ø¹Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸)</h1>
  <div style="display:flex;gap:10px;align-items:center">
    <div style="font-size:13px;color:#e6f0ff">Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹Ù‡ Ø¹Ù„Ù‰ GitHub ÙƒÙ…Ø§ Ù‡Ùˆ</div>
  </div>
</header>

<div class="container">
  <aside class="panel" role="region" aria-label="Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Øª">
    <h2>Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
    <div class="input-row">
      <input id="rootName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ø°Ù’Ø± (Ù…Ø«Ø§Ù„: Ø¬Ø¯ÙŠ)" value="Ø§Ù„Ø¬Ø¯">
      <button id="createRoot" class="small-btn">Ø¥Ù†Ø´Ø§Ø¡</button>
    </div>

    <p class="small">ØªÙˆÙ„ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ: Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡ Ù„ÙƒÙ„ ÙØ±Ø¹ Ø«Ù… Ø§Ø¶ØºØ· ØªÙˆÙ„ÙŠØ¯.</p>
    <div class="input-row">
      <input id="childrenCount" type="number" min="0" value="11">
      <input id="grandChildrenCount" type="number" min="0" value="5">
    </div>
    <div style="display:flex;gap:8px">
      <button id="generateBtn">ØªÙˆÙ„ÙŠØ¯ (Ù…Ø«Ø§Ù„ 11 Ã— 5)</button>
      <button id="clearBtn" class="muted-plain">Ù…Ø³Ø­ Ø§Ù„Ø´Ø¬Ø±Ø©</button>
    </div>

    <hr style="margin:12px 0;border:none;border-top:1px dashed #e6eefb">

    <h2>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
    <ul style="padding-left:18px;">
      <li>Ø§Ø¶ØºØ· <strong>â•</strong> Ù„Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹ Ù„Ø¢Ø®Ø±.</li>
      <li>Ø§Ø¶ØºØ· <strong>âœï¸</strong> Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù….</li>
      <li>Ø§Ø¶ØºØ· <strong>ğŸ—‘ï¸</strong> Ù„Ø­Ø°Ù Ø§Ù„Ø¹Ù‚Ø¯Ø© (Ø³ÙŠØ·Ø§Ù„Ø¨Ùƒ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡Ø§ Ø£Ø¨Ù†Ø§Ø¡).</li>
      <li>ÙŠÙ…ÙƒÙ† Ø³Ø­Ø¨ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø±Ø³Ù… Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ØŒ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ø¬Ù„Ø© Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ±.</li>
    </ul>
    <p class="hint">Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub: ÙÙ‚Ø· Ø§Ø±ÙØ¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø±Ø¨Ø·Ù‡ Ø¨ØµÙØ­Ø© GitHub Pages.</p>
  </aside>

  <main class="workspace">
    <div class="toolbar">
      <button id="zoomOut" class="muted small-btn">-</button>
      <button id="resetZoom" class="muted small-btn">100%</button>
      <button id="zoomIn" class="muted small-btn">+</button>
      <div style="flex:1"></div>
      <button id="exportPng" class="small-btn">ØªØµØ¯ÙŠØ± ØµÙˆØ±Ø© PNG</button>
    </div>

    <div class="canvas-wrap" id="canvasWrap">
      <!-- pan & zoom area -->
      <div id="tree-container" style="transform:translate(0px,0px) scale(1);">
        <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ø¬Ø±Ø© Ù‡Ù†Ø§ -->
      </div>
    </div>
  </main>
</div>

<!-- modal for prompt simple -->
<div id="promptModal" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.4);align-items:center;justify-content:center">
  <div style="background:white;padding:14px;border-radius:8px;min-width:320px;direction:rtl">
    <div style="font-weight:700;margin-bottom:8px">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…</div>
    <input id="promptInput" style="width:100%;padding:8px;border:1px solid #e6eefb;border-radius:6px" />
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
      <button id="promptCancel" class="muted-plain">Ø¥Ù„ØºØ§Ø¡</button>
      <button id="promptOk" class="small-btn">Ù…ÙˆØ§ÙÙ‚</button>
    </div>
  </div>
</div>

<script>
/*
  Ø´Ø¬Ø±Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸.
  Ø¨Ù†ÙŠØª ÙƒÙ…Ù‡ÙŠÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø¬Ø±ÙŠ (ÙƒØ§Ø¦Ù†Ø§Øª Ù…Ø¹ children[]) Ø«Ù… Ø±Ù†Ø¯Ø± DOM Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø±.
  Ø§Ù„Ù…ÙŠØ²Ø§Øª: Ø¥Ø¶Ø§ÙØ©ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ Ø­Ø°ÙØŒ Ø·ÙŠ/ÙØ±Ø¯ØŒ pan & zoomØŒ ØªÙˆÙ„ÙŠØ¯ Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒÙŠ.
*/

// Model: node = { id, name, children: [] }
let root = null;
let idCounter = 1;

// helpers
function makeNode(name){
  return { id: 'n' + (idCounter++), name: name || 'Ø´Ø®Øµ', children: [] };
}

function clearTree(){
  root = null;
  render();
}

// Render
const container = document.getElementById('tree-container');

function render(){
  container.innerHTML = '';
  if(!root) return;
  const rootWrap = document.createElement('div');
  rootWrap.className = 'tree-root';
  rootWrap.appendChild(renderNode(root));
  container.appendChild(rootWrap);
}

// render node recursively
function renderNode(node){
  const nodeEl = document.createElement('div');
  nodeEl.className = 'node';
  nodeEl.dataset.id = node.id;

  // card
  const card = document.createElement('div');
  card.className = 'node-card';
  const nameEl = document.createElement('div');
  nameEl.className = 'name';
  nameEl.textContent = node.name;
  card.appendChild(nameEl);

  // actions
  const actions = document.createElement('div');
  actions.className = 'node-actions';
  // add
  const addBtn = document.createElement('button');
  addBtn.title = 'Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹';
  addBtn.textContent = 'â•';
  addBtn.onclick = (e) => { e.stopPropagation(); promptForName('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø§Ø¨Ù†', (val)=>{ if(val) { node.children.push(makeNode(val)); render(); centerOn(node.id); } }); };
  actions.appendChild(addBtn);

  // edit
  const editBtn = document.createElement('button');
  editBtn.title = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…';
  editBtn.textContent = 'âœï¸';
  editBtn.onclick = (e) => { e.stopPropagation(); promptForName('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…', (val)=>{ if(val!==null){ node.name = val||node.name; render(); centerOn(node.id); } }, node.name); };
  actions.appendChild(editBtn);

  // collapse / expand
  const toggleBtn = document.createElement('button');
  toggleBtn.title = 'Ø·ÙŠ / ÙØ±Ø¯';
  toggleBtn.textContent = node._collapsed ? 'ğŸ”½' : 'ğŸ”¼';
  toggleBtn.onclick = (e) => { e.stopPropagation(); node._collapsed = !node._collapsed; render(); centerOn(node.id); };
  actions.appendChild(toggleBtn);

  // delete
  const delBtn = document.createElement('button');
  delBtn.title = 'Ø­Ø°Ù';
  delBtn.textContent = 'ğŸ—‘ï¸';
  delBtn.onclick = (e) => {
    e.stopPropagation();
    if(node === root){
      if(confirm('Ø³ØªØ­Ø°Ù Ø§Ù„Ø¬Ø°Ø± ÙˆÙƒÙ„ Ø§Ù„Ø´Ø¬Ø±Ø©. ØªØ£ÙƒØ¯ØŸ')) { clearTree(); }
      return;
    }
    if(node.children && node.children.length){
      if(!confirm('Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù‚Ø¯Ø© Ù„Ø¯ÙŠÙ‡Ø§ Ø£Ø¨Ù†Ø§Ø¡. Ø­Ø°ÙÙ‡Ø§ Ø³ÙŠØ­Ø°Ù ÙƒÙ„ Ø£Ø¨Ù†Ø§Ø¡Ù‡Ø§. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) return;
    }
    removeNodeById(root, node.id);
    render();
  };
  actions.appendChild(delBtn);

  card.appendChild(actions);
  nodeEl.appendChild(card);

  // connector vertical line
  const vconn = document.createElement('div');
  vconn.className = 'connector-vertical';
  nodeEl.appendChild(vconn);

  // children
  if(node.children && node.children.length && !node._collapsed){
    const childrenWrap = document.createElement('div');
    childrenWrap.className = 'children';
    node.children.forEach(child => {
      const childNodeEl = renderNode(child);
      // horizontal connector line
      const hline = document.createElement('div');
      hline.className = 'connector-horizontal';
      // attach hline to child wrapper relative to parent
      childNodeEl.appendChild(hline);
      childrenWrap.appendChild(childNodeEl);
    });
    nodeEl.appendChild(childrenWrap);
  }

  return nodeEl;
}

// remove node by id
function removeNodeById(parent, id){
  if(!parent || !parent.children) return false;
  for(let i=0;i<parent.children.length;i++){
    if(parent.children[i].id === id){
      parent.children.splice(i,1);
      return true;
    } else {
      if(removeNodeById(parent.children[i], id)) return true;
    }
  }
  return false;
}

// simple prompt modal
const promptModal = document.getElementById('promptModal');
const promptInput = document.getElementById('promptInput');
let promptCallback = null;
function promptForName(title, callback, defaultVal=''){
  promptCallback = callback;
  promptInput.value = defaultVal||'';
  promptModal.style.display = 'flex';
  setTimeout(()=>promptInput.focus(),50);
}
document.getElementById('promptOk').onclick = ()=>{ promptModal.style.display='none'; if(promptCallback) promptCallback(promptInput.value); promptCallback = null; };
document.getElementById('promptCancel').onclick = ()=>{ promptModal.style.display='none'; if(promptCallback) promptCallback(null); promptCallback = null; };

// center on node (attempt)
function centerOn(nodeId){
  // find element
  const el = container.querySelector(`[data-id="${nodeId}"]`);
  if(!el) return;
  // compute position relative to container wrap
  const wrap = document.getElementById('canvasWrap');
  const wrapRect = wrap.getBoundingClientRect();
  const elRect = el.getBoundingClientRect();
  const treeRect = container.getBoundingClientRect();

  // current transform
  const style = container.style.transform;
  const m = /translate\((-?\d+(?:\.\d+)?)px,(-?\d+(?:\.\d+)?)px\)\s*scale\((\d+(?:\.\d+)?)\)/.exec(style);
  let tx=0, ty=0, scale=1;
  if(m){ tx = parseFloat(m[1]); ty = parseFloat(m[2]); scale = parseFloat(m[3]); }

  // target center
  const elCenterX = (elRect.left + elRect.right)/2 - treeRect.left;
  const elCenterY = (elRect.top + elRect.bottom)/2 - treeRect.top;

  const wrapCenterX = wrapRect.width / 2;
  const wrapCenterY = wrapRect.height / 2;

  // new translate to center that element
  const newTx = wrapCenterX - elCenterX * scale;
  const newTy = wrapCenterY - elCenterY * scale;
  container.style.transform = `translate(${newTx}px,${newTy}px) scale(${scale})`;
}

// create root
document.getElementById('createRoot').onclick = ()=>{
  const name = document.getElementById('rootName').value.trim() || 'Ø§Ù„Ø¬Ø¯';
  root = makeNode(name);
  render();
  centerOn(root.id);
};

// generate automatic
document.getElementById('generateBtn').onclick = ()=>{
  const rootName = document.getElementById('rootName').value.trim() || 'Ø§Ù„Ø¬Ø¯';
  const c = Math.max(0, parseInt(document.getElementById('childrenCount').value || 0));
  const g = Math.max(0, parseInt(document.getElementById('grandChildrenCount').value || 0));
  root = makeNode(rootName);
  // create c children
  for(let i=1;i<=c;i++){
    const child = makeNode('Ø§Ø¨Ù† ' + i);
    for(let j=1;j<=g;j++){
      child.children.push(makeNode('Ø­ÙÙŠØ¯ ' + i + '.' + j));
    }
    root.children.push(child);
  }
  render();
  centerOn(root.id);
};

document.getElementById('clearBtn').onclick = ()=>{
  if(confirm('Ù…Ø³Ø­ ÙƒØ§Ù…Ù„ Ù„Ù„Ø´Ø¬Ø±Ø©ØŸ')) clearTree();
};

// initial: create a root by default
root = makeNode(document.getElementById('rootName').value || 'Ø§Ù„Ø¬Ø¯');
render();
centerOn(root.id);

// Pan & Zoom
const canvasWrap = document.getElementById('canvasWrap');
let isPanning = false, startX=0, startY=0, translateX=0, translateY=0, scale=1;

function updateTransform(){
  container.style.transform = `translate(${translateX}px,${translateY}px) scale(${scale})`;
}
canvasWrap.addEventListener('pointerdown', (e)=>{
  isPanning = true;
  startX = e.clientX;
  startY = e.clientY;
  canvasWrap.setPointerCapture(e.pointerId);
});
window.addEventListener('pointermove', (e)=>{
  if(!isPanning) return;
  const dx = e.clientX - startX;
  const dy = e.clientY - startY;
  startX = e.clientX;
  startY = e.clientY;
  translateX += dx;
  translateY += dy;
  updateTransform();
});
window.addEventListener('pointerup', (e)=>{
  isPanning = false;
});

// wheel zoom
canvasWrap.addEventListener('wheel', (e)=>{
  e.preventDefault();
  const zoomIntensity = 0.0015;
  const delta = -e.deltaY;
  const zoom = Math.exp(delta * zoomIntensity);

  // compute mouse point relative to container
  const rect = container.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  // zoom around mouse: translate so that mouse remains in place
  const newScale = Math.min(3, Math.max(0.2, scale * zoom));
  const ratio = newScale / scale;

  translateX = (translateX - mx) * ratio + mx;
  translateY = (translateY - my) * ratio + my;
  scale = newScale;
  updateTransform();
}, { passive:false });

// toolbar buttons
document.getElementById('zoomIn').onclick = ()=>{ scale = Math.min(3, scale + 0.1); updateTransform(); };
document.getElementById('zoomOut').onclick = ()=>{ scale = Math.max(0.2, scale - 0.1); updateTransform(); };
document.getElementById('resetZoom').onclick = ()=>{ scale = 1; translateX = 0; translateY = 0; updateTransform(); };

// Export PNG (simple approach using svg + foreignObject wrapper)
document.getElementById('exportPng').onclick = async ()=>{
  // temporarily render tree inside an SVG foreignObject and export as PNG
  try{
    // clone container
    const clone = container.cloneNode(true);
    // remove transform to get full size
    clone.style.transform = 'translate(0px,0px) scale(1)';
    // compute bounds
    const bbox = clone.getBoundingClientRect();
    // create SVG
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${Math.max(800,bbox.width)}' height='${Math.max(600,bbox.height)}'>
      <foreignObject width='100%' height='100%'>${new XMLSerializer().serializeToString(clone)}</foreignObject></svg>`;
    const blob = new Blob([svg], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const img = new Image();
    img.onload = ()=>{
      const canvas = document.createElement('canvas');
      canvas.width = Math.max(800, Math.ceil(bbox.width));
      canvas.height = Math.max(600, Math.ceil(bbox.height));
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#fff';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0);
      URL.revokeObjectURL(url);
      canvas.toBlob((blob2)=>{
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob2);
        a.download = 'family-tree.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
      }, 'image/png');
    };
    img.onerror = ()=>{ alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙˆØ±Ø©. Ø­Ø§ÙˆÙ„ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø´Ø¬Ø±Ø©.'); URL.revokeObjectURL(url); };
    img.src = url;
  } catch(err){
    console.error(err);
    alert('ØªØ¹Ø°Ø± Ø§Ù„ØªØµØ¯ÙŠØ±: ' + err.message);
  }
};

/* small UX: click node to center */
container.addEventListener('click', (e)=>{
  const node = e.target.closest('.node');
  if(node && node.dataset.id){
    centerOn(node.dataset.id);
  }
});
</script>
</body>
</html>
