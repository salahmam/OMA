<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù†Ø¸Ø§Ù… OMA - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</title>
<style>
:root{
  --primary:#004aad;
  --accent:#ffcc33;
  --bg:#f5f9ff;
  --card:#fff;
}
*{box-sizing:border-box}
body{
  font-family: 'Cairo',sans-serif;
  margin:0;background:linear-gradient(180deg,var(--bg),#fff);
  color:#102027;direction:rtl;visibility:hidden;
}
header{
  background:linear-gradient(90deg,var(--primary),#007bff);
  color:#fff;padding:18px 16px;text-align:center;font-size:20px;font-weight:700;
  box-shadow:0 3px 12px rgba(2,20,40,0.08);
}
.wrap{max-width:1200px;margin:22px auto;padding:12px;display:flex;flex-direction:column;gap:18px;}
.card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(6,20,30,0.06);}
.form-grid{display:flex;flex-wrap:wrap;gap:10px}
input[type="text"], input[type="tel"], input[type="number"], select, textarea {
  padding:10px;border:1px solid #d6dde9;border-radius:8px;font-size:15px;width:100%;
}
.two{width:calc(50% - 6px)}
.three{width:calc(33.333% - 8px)}
label{display:block;margin-bottom:6px;font-size:13px;color:#37474f}
.btn{background:var(--primary);color:#fff;padding:10px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:700}
.btn.warn{background:#ff7043}
.btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(0,74,173,0.12)}
.btn.small{padding:6px 8px;font-size:13px;border-radius:6px}
.add-subj{display:inline-block;margin-top:6px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;font-size:14px}
th{background:var(--primary);color:#fff}
.actions button{margin:0 6px}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef6ff;color:var(--primary);font-weight:700}
.flex{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start}
.left,.right{flex:1;display:flex;flex-direction:column;gap:10px}
.subject-field{display:flex;gap:6px;align-items:center;margin-bottom:6px}
</style>
</head>
<body>
<header>Ù†Ø¸Ø§Ù… OMA - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</header>
<div class="wrap">

  <!-- Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° -->
  <div class="card">
    <div class="flex">
      <!-- Ø¬Ù‡Ø© Ø§Ù„ÙŠÙ…ÙŠÙ†: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø° ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ -->
      <div class="right">
        <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø°</strong>
        <div class="form-grid">
          <div class="two">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input id="teacherName" type="text" required />
          </div>
          <div class="two">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input id="teacherPhone" type="tel" required />
          </div>
        </div>
        <div>
          <label>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ÙŠØ¯Ø±Ø³Ù‡Ø§</label>
          <div id="teacherSubjectsContainer"></div>
          <button id="addTeacherSubjectBtn" type="button" class="btn ghost small add-subj">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
        </div>
        <div class="form-grid">
          <div class="two">
            <label>Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
            <input id="teacherStages" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£ÙˆÙ„Ù‰ØŒ Ø«Ø§Ù†ÙŠØ©" />
          </div>
          <div class="two">
            <label>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª / Ø§Ù„ÙƒØ±ÙˆØ¨Ø§Øª</label>
            <input id="teacherGroups" type="text" placeholder="Ù…Ø«Ø§Ù„: A, B, 101" />
          </div>
        </div>
        <button id="saveTeacherBtn" class="btn">âœ… Ø­ÙØ¸ Ø§Ù„Ø£Ø³ØªØ§Ø°</button>
      </div>

      <!-- Ø¬Ù‡Ø© Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ -->
      <div class="left">
        <strong>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ</strong>
        <p>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ù„Øº: <span id="totalAmount">0</span></p>
        <p>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©: <span id="totalPayments">0</span></p>
        <p>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ù…Ø¹Ù‡Ø¯: <span id="remainingAmount">0</span></p>
      </div>
    </div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª -->
  <div class="card">
    <strong>Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø°</strong>
    <table id="teacherPaymentsTable">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹Ø©</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

// ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    document.body.style.visibility = "visible";
    loadTeacherPayments();
  }
});

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯
const teacherSubjectsContainer = document.getElementById("teacherSubjectsContainer");
document.getElementById("addTeacherSubjectBtn").addEventListener("click", ()=>{
  const div = document.createElement("div");
  div.classList.add("subject-field");
  div.innerHTML = `
    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" class="teacherSubjName" required />
    <button type="button" class="btn warn small removeSubjBtn">âŒ</button>
  `;
  teacherSubjectsContainer.appendChild(div);
  div.querySelector(".removeSubjBtn").addEventListener("click", ()=>teacherSubjectsContainer.removeChild(div));
});

// Ø­ÙØ¸ Ø§Ù„Ø£Ø³ØªØ§Ø°
document.getElementById("saveTeacherBtn").addEventListener("click", async ()=>{
  const name = document.getElementById("teacherName").value.trim();
  const phone = document.getElementById("teacherPhone").value.trim();
  const stages = document.getElementById("teacherStages").value.trim();
  const groups = document.getElementById("teacherGroups").value.trim();

  const subjects = [];
  document.querySelectorAll(".teacherSubjName").forEach(sub=>{
    const subj = sub.value.trim();
    if(subj) subjects.push(subj);
  });

  if(!name || !phone || subjects.length===0){ alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©"); return; }

  try{
    await addDoc(collection(db,"teachers"),{
      name, phone, stages, groups, subjects, createdAt:new Date()
    });
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ù†Ø¬Ø§Ø­");
    document.getElementById("teacherName").value="";
    document.getElementById("teacherPhone").value="";
    document.getElementById("teacherStages").value="";
    document.getElementById("teacherGroups").value="";
    teacherSubjectsContainer.innerHTML="";
  }catch(err){console.error(err); alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");}
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª (Ù…Ø«Ø§Ù„ ÙˆÙ‡Ù…ÙŠ Ø­ØªÙ‰ Ø±Ø¨Ø·Ù‡ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
async function loadTeacherPayments(){
  const snapshot = await getDocs(collection(db,"teacherPayments"));
  const tbody = document.querySelector("#teacherPaymentsTable tbody");
  tbody.innerHTML="";
  let totalAmount=0, totalPayments=0;
  snapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${data.subject}</td><td>${data.amount}</td><td>${data.date}</td>`;
    tbody.appendChild(tr);
    totalAmount += data.amount;
    totalPayments += data.paid || 0;
  });
  document.getElementById("totalAmount").innerText=totalAmount;
  document.getElementById("totalPayments").innerText=totalPayments;
  document.getElementById("remainingAmount").innerText=totalAmount - totalPayments;
}
</script>
</body>
</html>