<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù†Ø¸Ø§Ù… OMA - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</title>
<style>
:root{
  --primary:#004aad;
  --accent:#ffcc33;
  --bg:#f5f9ff;
  --card:#fff;
}
*{box-sizing:border-box}
body{
  font-family: 'Cairo',sans-serif;
  margin:0;background:linear-gradient(180deg,var(--bg),#fff);
  color:#102027;direction:rtl;
}
header{
  background:linear-gradient(90deg,var(--primary),#007bff);
  color:#fff;padding:18px 16px;text-align:center;font-size:20px;font-weight:700;
  box-shadow:0 3px 12px rgba(2,20,40,0.08);
}
.wrap{max-width:1200px;margin:22px auto;padding:12px;}
.card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(6,20,30,0.06);margin-bottom:16px;}
.form-grid{display:flex;flex-wrap:wrap;gap:10px}
input[type="text"], input[type="tel"], input[type="number"], select {
  padding:10px;border:1px solid #d6dde9;border-radius:8px;font-size:15px;width:100%;
}
.two{width:calc(50% - 6px)}
.three{width:calc(33.333% - 8px)}
label{display:block;margin-bottom:6px;font-size:13px;color:#37474f}
.btn{background:var(--primary);color:#fff;padding:10px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:700}
.btn.warn{background:#ff7043}
.btn.ghost{background:transparent;color:var(--primary);border:1px solid rgba(0,74,173,0.12)}
.btn.small{padding:6px 8px;font-size:13px;border-radius:6px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;font-size:14px}
th{background:var(--primary);color:#fff}
.actions button{margin:0 6px}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#eef6ff;color:var(--primary);font-weight:700}
@media print{
  body{background:white;padding:0}
  header, .card form, .actions, .filters, #addTeacherBtn { display:none !important; }
  .print-page{box-shadow:none;margin:0;padding:0}
}
</style>
</head>
<body>
<header>Ù†Ø¸Ø§Ù… OMA - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</header>
<div class="wrap">

<!-- Ø¥Ø¶Ø§ÙØ© Ø£Ø³ØªØ§Ø° Ø¬Ø¯ÙŠØ¯ -->
<div class="card">
  <strong>Ø£Ø¶Ù Ø£Ø³ØªØ§Ø° Ø¬Ø¯ÙŠØ¯</strong>
  <form id="teacherForm" style="margin-top:12px">
    <div class="form-grid">
      <div class="two">
        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input id="teacherName" type="text" required/>
      </div>
      <div class="two">
        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input id="teacherPhone" type="tel" required/>
      </div>
      <div style="width:100%">
        <label>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ÙŠØ¯Ø±Ù‘Ø³Ù‡Ø§ (ÙØµÙ„ ÙƒÙ„ Ù…Ø§Ø¯Ø© Ø¨ÙØ§ØµÙ„Ø©)</label>
        <input id="teacherSubjects" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø±ÙŠØ§Ø¶ÙŠØ§Øª, ÙÙŠØ²ÙŠØ§Ø¡" required/>
      </div>
      <div style="width:100%;display:flex;justify-content:flex-end;gap:8px;margin-top:8px;">
        <button type="submit" class="btn">âœ… Ø­ÙØ¸ Ø§Ù„Ø£Ø³ØªØ§Ø°</button>
        <button type="button" id="clearTeacherForm" class="btn ghost">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
      </div>
    </div>
  </form>
</div>

<!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© -->
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <strong>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</strong>
    <button id="printTeachersBtn" class="btn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒÙ„</button>
  </div>
  <table id="teachersTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th>Ø§Ù„Ù…ÙˆØ§Ø¯</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
        <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³Ù„Ù…</th>
        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
        <th>Ø®ÙŠØ§Ø±Ø§Øª</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const teacherForm = document.getElementById("teacherForm");
const teachersTableBody = document.querySelector("#teachersTable tbody");

// Ø­ÙØ¸ Ø£Ø³ØªØ§Ø° Ø¬Ø¯ÙŠØ¯
teacherForm.addEventListener("submit", async(e)=>{
  e.preventDefault();
  const name = document.getElementById("teacherName").value.trim();
  const phone = document.getElementById("teacherPhone").value.trim();
  const subjects = document.getElementById("teacherSubjects").value.split(",").map(s=>s.trim()).filter(s=>s);

  if(subjects.length===0){alert("Ø£Ø¶Ù Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return;}

  try{
    await addDoc(collection(db,"teachers"),{
      name,phone,subjects,totalDue:0,paid:0,remaining:0
    });
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ù†Ø¬Ø§Ø­");
    teacherForm.reset();
    loadTeachers();
  }catch(err){console.error(err);alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");}
});

// Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
document.getElementById("clearTeacherForm").addEventListener("click",()=>{teacherForm.reset();});

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª
async function loadTeachers(){
  const snapshot = await getDocs(collection(db,"teachers"));
  teachersTableBody.innerHTML="";
  snapshot.forEach(docSnap=>{
    const t = {...docSnap.data(),id:docSnap.id};

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¨
    let totalDue=0;
    let paid=0;
    t.subjects.forEach(sub=>{
      // Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©
      // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ± Ø¨Ø­ÙŠØ« ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø©
      // Ø­Ø§Ù„ÙŠØ§ Ù…Ø¬Ø±Ø¯ Ù…Ø«Ø§Ù„: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ù„Ø£ÙŠ Ø·Ø§Ù„Ø¨ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©
    });
    const remaining = totalDue - paid;

    const tr = document.createElement("tr");
    tr.innerHTML=`
      <td>${t.name}</td>
      <td>${t.phone}</td>
      <td>${t.subjects.join(", ")}</td>
      <td>${totalDue}</td>
      <td>${paid}</td>
      <td>${remaining}</td>
      <td class="actions">
        <button class="btn small" onclick="printTeacher('${t.id}')">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</button>
        <button class="btn warn small" onclick="deleteTeacher('${t.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </td>`;
    teachersTableBody.appendChild(tr);
  });
}
loadTeachers();

// Ø­Ø°Ù Ø£Ø³ØªØ§Ø°
async function deleteTeacher(id){
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø£Ø³ØªØ§Ø°ØŸ")){
    await deleteDoc(doc(db,"teachers",id));
    loadTeachers();
  }
}

// Ø·Ø¨Ø§Ø¹Ø© Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø£Ø³ØªØ§Ø°
async function printTeacher(id){
  const docSnap = await getDocs(collection(db,"teachers"));
  const t = docSnap.docs.map(d=>({...d.data(),id:d.id})).find(x=>x.id===id);
  if(!t) return;

  const printWindow = window.open("","_blank");
  printWindow.document.write(`<html dir="rtl"><head><title>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°</title><style>
    body{font-family:'Cairo',sans-serif;padding:20px}
    h2{text-align:center}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #000;padding:8px;text-align:center}
    th{background:#004aad;color:#fff}
  </style></head><body>
    <h2>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°</h2>
    <p><b>Ø§Ù„Ø§Ø³Ù…:</b> ${t.name}</p>
    <p><b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${t.phone}</p>
    <table>
      <tr><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³Ù„Ù…</th><th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th></tr>
      <tr><td>${t.totalDue}</td><td>${t.paid}</td><td>${t.remaining}</td></tr>
    </table>
    <p>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø£Ø³ØªØ§Ø°: .....................</p>
    <p>Ø®ØªÙ… Ø§Ù„Ù…Ø¹Ù‡Ø¯: .....................</p>
  </body></html>`);
  printWindow.document.close();
  printWindow.print();
}

// Ø·Ø¨Ø§Ø¹Ø© ÙƒÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©
document.getElementById("printTeachersBtn").addEventListener("click",()=>{window.print();});

</script>
</body>
</html>