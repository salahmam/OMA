<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… OMA</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, doc, setDoc, collection, deleteDoc, getDocs, serverTimestamp, addDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

// ğŸ”¹ Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ
const firebaseConfig = {
  apiKey: "AIzaSyAMANgdrLgoGIjqLZOcS_qyEqCUOVC7gOU",
  authDomain: "oma0-33cc0.firebaseapp.com",
  projectId: "oma0-33cc0",
  storageBucket: "oma0-33cc0.appspot.com",
  messagingSenderId: "899300774863",
  appId: "1:899300774863:web:0a81a7f5747ef37d49b8ba"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

async function resetSystem() {
  const confirmReset = confirm("âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ");
  if (!confirmReset) return;

  const status = document.getElementById('status');
  status.textContent = "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©...";

  try {
    // Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø§Øª users Ùˆ institutes
    const collections = ['users', 'institutes'];
    for (const col of collections) {
      const snap = await getDocs(collection(db, col));
      for (const d of snap.docs) await deleteDoc(doc(db, col, d.id));
    }

    status.textContent = "âœ… ØªÙ… Ø§Ù„Ø­Ø°ÙØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…...";

    // Ø¥Ù†Ø´Ø§Ø¡ superAdmin
    const superAdminEmail = "admin@oma.com";
    const superAdminPass = "123456";
    const superCred = await createUserWithEmailAndPassword(auth, superAdminEmail, superAdminPass);

    await setDoc(doc(db, "users", superCred.user.uid), {
      name: "Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…",
      email: superAdminEmail,
      type: "superAdmin",
      createdAt: serverTimestamp()
    });

    status.textContent = "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…ØŒ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...";

    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ù‡Ø¯ÙŠÙ† ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†
    const demoInstitutes = [
      { name: "Ù…Ø¹Ù‡Ø¯ ØªØ¬Ø±ÙŠØ¨ÙŠ 1", email: "demo1@oma.edu", password: "123456demo1", plan: "trial" },
      { name: "Ù…Ø¹Ù‡Ø¯ ØªØ¬Ø±ÙŠØ¨ÙŠ 2", email: "demo2@oma.edu", password: "123456demo2", plan: "trial" }
    ];

    for (const ins of demoInstitutes) {
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙŠ Auth
      const cred = await createUserWithEmailAndPassword(auth, ins.email, ins.password);
      const adminId = cred.user.uid;

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø¹Ù‡Ø¯ ÙÙŠ Firestore
      const docRef = await addDoc(collection(db, "institutes"), {
        name: ins.name,
        adminId,
        adminEmail: ins.email,
        colors: { primary: "#004aad", bg: "#f5f9ff", card: "#fff", accent: "#ffcc33" },
        subscriptionType: ins.plan,
        createdAt: serverTimestamp()
      });

      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø±ØªØ¨Ø·
      await setDoc(doc(db, "users", adminId), {
        uid: adminId,
        type: "instituteAdmin",
        instituteId: docRef.id,
        email: ins.email,
        createdAt: serverTimestamp()
      });
    }

    status.textContent = "ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ÙƒÙ„ Ù…Ø¯ÙŠØ±.";
  } catch (err) {
    console.error(err);
    status.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: " + err.message;
  }
}
</script>
</head>
<body style="font-family:'Cairo',sans-serif;direction:rtl;text-align:center;margin-top:100px">
  <h2>ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… OMA</h2>
  <p>Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ø¬Ø¯ÙŠØ¯.</p>
  <button onclick="resetSystem()" style="padding:10px 20px;font-size:18px;background:#004aad;color:white;border:none;border-radius:6px;">ğŸš€ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù†</button>
  <p id="status" style="margin-top:20px;color:#004aad;font-weight:bold"></p>
</body>
</html>
