<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… OMA</title>
<style>
body{font-family:'Cairo',sans-serif;padding:20px;background:#f5f9ff}
h2{color:#004aad;text-align:center}
#status{white-space:pre-wrap;margin-top:12px;font-size:14px;color:#222}
button{padding:10px 14px;background:#004aad;color:#fff;border:none;border-radius:6px;cursor:pointer;margin-top:12px}
</style>
</head>
<body>
<h2>ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… OMA</h2>
<button id="initBtn">ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¢Ù…Ù†Ø©</button>
<pre id="status"></pre>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, fetchSignInMethodsForEmail } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAMANgdrLgoGIjqLZOcS_qyEqCUOVC7gOU",
  authDomain: "oma0-33cc0.firebaseapp.com",
  projectId: "oma0-33cc0",
  storageBucket: "oma0-33cc0.firebasestorage.app",
  messagingSenderId: "899300774863",
  appId: "1:899300774863:web:0a81a7f5747ef37d49b8ba",
  measurementId: "G-5CKWYQT9XZ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const statusEl = document.getElementById('status');
function log(msg){ statusEl.textContent += msg + '\n'; }
function clearLog(){ statusEl.textContent = ''; }

async function initSystem(){
  clearLog();
  log('âœ… Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¢Ù…Ù†Ø©...');

  // 1ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ superAdmin Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
  const superAdmin = { email:'Salahalkaleefa@gmail.com', password:'123456salah' };
  try{
    const methods = await fetchSignInMethodsForEmail(auth, superAdmin.email);
    if(methods.length === 0){
      log('â³ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ superAdmin...');
      await createUserWithEmailAndPassword(auth, superAdmin.email, superAdmin.password);
      log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ superAdmin');
    } else {
      log('â„¹ï¸ Ø­Ø³Ø§Ø¨ superAdmin Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù„Ù† ÙŠØªÙ… Ø­Ø°ÙÙ‡');
    }
  } catch(err){ log('âŒ Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† superAdmin: '+err.message); return; }

  // 2ï¸âƒ£ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
  try{
    log('â³ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©...');
    const coll = collection(db,'institutes');
    const snap = await getDocs(coll);
    for(const docSnap of snap.docs){
      await deleteDoc(doc(db,'institutes',docSnap.id));
      log('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ù‡Ø¯: '+docSnap.data().name);
    }
    log('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©');
  } catch(err){ log('âŒ Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯: '+err.message); return; }

  // 3ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ù‡Ø¯ÙŠÙ† ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†
  const institutes = [
    { name:'Ù…Ø¹Ù‡Ø¯ OMA Ø¨ØºØ¯Ø§Ø¯', adminEmail:'demo1@oma.edu', adminPassword:'123456demo1', colors:{primary:'#004aad', bg:'#f5f9ff', card:'#fff', accent:'#ffcc33'}, plan:'trial' },
    { name:'Ù…Ø¹Ù‡Ø¯ OMA Ø£Ø±Ø¨ÙŠÙ„', adminEmail:'demo2@oma.edu', adminPassword:'123456demo2', colors:{primary:'#ff6600', bg:'#fff0e6', card:'#fff', accent:'#33ccff'}, plan:'yearly' }
  ];

  for(const inst of institutes){
    try{
      log('â³ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯: '+inst.adminEmail);
      const cred = await createUserWithEmailAndPassword(auth, inst.adminEmail, inst.adminPassword);
      const adminId = cred.user.uid;
      log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠØ±: '+inst.adminEmail);

      const docRef = await addDoc(collection(db,'institutes'),{
        name:inst.name,
        adminId,
        adminEmail:inst.adminEmail,
        colors:inst.colors,
        subscriptionType:inst.plan,
        createdAt:serverTimestamp()
      });
      log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯: '+inst.name+' (ID:'+docRef.id+')');
    } catch(err){ log('âŒ Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯/Ø§Ù„Ù…Ø¯ÙŠØ±: '+err.message); }
  }

  log('ğŸ‰ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¢Ù…Ù†Ø© Ø§ÙƒØªÙ…Ù„Øª!');
}

document.getElementById('initBtn').addEventListener('click', initSystem);
</script>
</body>
</html>