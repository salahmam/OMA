<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù†Ø¸Ø§Ù… OMA - Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨</title>
<style>
body{font-family:'Cairo',sans-serif;direction:rtl;margin:0;background:#f5f9ff;color:#102027;}
header{background:#004aad;color:#fff;padding:18px;text-align:center;font-size:20px;font-weight:700;}
.wrap{max-width:1200px;margin:22px auto;padding:12px;}
.card{background:#fff;border-radius:10px;padding:14px;margin-bottom:16px;box-shadow:0 6px 18px rgba(6,20,30,0.06);}
table{width:100%;border-collapse:collapse;margin-top:12px;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;font-size:14px;}
th{background:#004aad;color:#fff;}
.checkbox{width:18px;height:18px;}
.btn{background:#004aad;color:#fff;padding:8px 12px;border:none;border-radius:8px;cursor:pointer;font-weight:700;}
@media print{
  body{background:white;}
  header,.filters,.actions{display:none !important;}
}
</style>
</head>
<body>
<header>Ù†Ø¸Ø§Ù… OMA - Ø­Ø¶ÙˆØ± ÙˆØºÙŠØ§Ø¨ Ø§Ù„Ø·Ù„Ø§Ø¨</header>
<div class="wrap">
<div class="card">
  <strong>Ø§Ø®ØªØ± Ø§Ù„Ø­ØµØ©</strong>
  <select id="classSelect"></select>
</div>
<div class="card">
  <strong>Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ†</strong>
  <table id="attendanceTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø­Ø§Ø¶Ø±</th>
        <th>ØºØ§Ø¦Ø¨</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button id="saveAttendanceBtn" class="btn" style="margin-top:10px;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const classSelect = document.getElementById("classSelect");
const attendanceTableBody = document.querySelector("#attendanceTable tbody");
let classesData = [], selectedClass=null;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­ØµØµ
async function loadClasses(){
  const snapshot = await getDocs(collection(db,"classes"));
  classSelect.innerHTML="<option value=''>Ø§Ø®ØªØ± Ø§Ù„Ø­ØµØ©</option>";
  classesData = [];
  snapshot.forEach(docSnap=>{
    const c = {...docSnap.data(),id:docSnap.id};
    classesData.push(c);
    classSelect.innerHTML+=`<option value="${c.id}">${c.subjectId} - ${c.group} - ${c.day} ${c.time}</option>`;
  });
}
loadClasses();

classSelect.addEventListener("change",()=>{
  const classId = classSelect.value;
  selectedClass = classesData.find(c=>c.id===classId);
  if(!selectedClass){attendanceTableBody.innerHTML=""; return;}
  renderAttendance(selectedClass);
});

function renderAttendance(cls){
  attendanceTableBody.innerHTML="";
  cls.students.forEach(s=>{
    attendanceTableBody.innerHTML+=`
      <tr>
        <td>${s.name}</td>
        <td><input type="checkbox" class="checkbox present" data-id="${s.id}"></td>
        <td><input type="checkbox" class="checkbox absent" data-id="${s.id}"></td>
      </tr>
    `;
  });
}

// Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ±
document.getElementById("saveAttendanceBtn").addEventListener("click", async()=>{
  if(!selectedClass) return;
  const updatedAttendance = selectedClass.students.map(s=>{
    const present = document.querySelector(`.present[data-id='${s.id}']`).checked;
    const absent = document.querySelector(`.absent[data-id='${s.id}']`).checked;
    return {studentId:s.id,status:present?"Ø­Ø§Ø¶Ø±":absent?"ØºØ§Ø¦Ø¨":"ØºÙŠØ± Ù…Ø­Ø¯Ø¯",date:new Date()};
  });
  await updateDoc(doc(db,"classes",selectedClass.id),{attendance:updatedAttendance});
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
});
</script>
</body>
</html>