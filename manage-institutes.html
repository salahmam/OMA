<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ - Ù†Ø¸Ø§Ù… OMA</title>
<style>
:root {
  --primary:#004aad; --bg:#f5f9ff; --card:#fff;
}
body { margin:0; font-family:'Cairo',sans-serif; background:var(--bg); }
header { background:var(--primary); color:white; text-align:center; padding:15px; font-size:20px; font-weight:bold; }
.container { padding:30px; display:flex; gap:30px; flex-wrap:wrap; }
.card { background:var(--card); padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); flex:1 1 400px; }
input, select { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; font-size:15px; }
button { padding:12px; width:100%; border:none; border-radius:8px; background:var(--primary); color:white; font-size:16px; cursor:pointer; transition:0.3s; }
button:hover { background:#003a8c; }
.error { color:red; margin-bottom:10px; font-size:14px; }
.institute-list { margin-top:20px; }
.institute-item { background:#eef4ff; margin:5px 0; padding:10px; border-radius:6px; }
</style>
</head>
<body>

<header>ğŸ› ï¸ Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯ - Ù†Ø¸Ø§Ù… OMA</header>

<div class="container">

  <div class="card">
    <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù‡Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
    <p class="error" id="errorMsg"></p>
    <input type="text" id="instituteName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù‡Ø¯" required />
    <input type="email" id="adminEmail" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯" required />
    <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯" required />
    <input type="file" id="logoFile" accept="image/*" />
    <label>Ù„ÙˆÙ† Ø±Ø¦ÙŠØ³ÙŠ:</label>
    <input type="color" id="mainColor" value="#004aad" />
    <label>Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ©:</label>
    <input type="color" id="bgColor" value="#f5f9ff" />
    <select id="duration">
      <option value="lifetime">Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©</option>
      <option value="trial">ØªØ¬Ø±ÙŠØ¨ÙŠ</option>
    </select>
    <button id="createBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯</button>
  </div>

  <div class="card">
    <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ù‡Ø¯</h3>
    <div class="institute-list" id="instituteList"></div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, collection, addDoc, setDoc, doc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAMANgdrLgoGIjqLZOcS_qyEqCUOVC7gOU",
  authDomain: "oma0-33cc0.firebaseapp.com",
  projectId: "oma0-33cc0",
  storageBucket: "oma0-33cc0.firebasestorage.app",
  messagingSenderId: "899300774863",
  appId: "1:899300774863:web:0a81a7f5747ef37d49b8ba",
  measurementId: "G-5CKWYQT9XZ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

const instituteName = document.getElementById("instituteName");
const adminEmail = document.getElementById("adminEmail");
const adminPassword = document.getElementById("adminPassword");
const logoFile = document.getElementById("logoFile");
const mainColor = document.getElementById("mainColor");
const bgColor = document.getElementById("bgColor");
const duration = document.getElementById("duration");
const createBtn = document.getElementById("createBtn");
const errorMsg = document.getElementById("errorMsg");
const instituteList = document.getElementById("instituteList");

async function loadInstitutes(){
  instituteList.innerHTML = "";
  const snapshot = await getDocs(collection(db,"institutes"));
  snapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "institute-item";
    div.textContent = `${data.name} - ${data.email} - ${data.duration}`;
    instituteList.appendChild(div);
  });
}

loadInstitutes();

createBtn.addEventListener("click", async()=>{
  const name = instituteName.value.trim();
  const email = adminEmail.value.trim();
  const password = adminPassword.value.trim();
  if(!name || !email || !password){
    errorMsg.textContent="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.";
    return;
  }

  createBtn.disabled = true;
  createBtn.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...";
  errorMsg.textContent="";

  try{
    // Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±
    let logoURL = "";
    if(logoFile.files.length>0){
      const file = logoFile.files[0];
      const storageRef = ref(storage,"institute-logos/"+Date.now()+"-"+file.name);
      await uploadBytes(storageRef,file);
      logoURL = await getDownloadURL(storageRef);
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const userCred = await createUserWithEmailAndPassword(auth,email,password);
    const adminId = userCred.user.uid;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯
    const docRef = await addDoc(collection(db,"institutes"),{
      name,
      email,
      logoURL,
      mainColor: mainColor.value,
      bgColor: bgColor.value,
      duration: duration.value,
      createdAt: serverTimestamp()
    });

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯ ÙÙŠ users Ù…Ø¹ uid ÙƒÙ…ÙØªØ§Ø­
    await setDoc(doc(db,"users",adminId),{
      uid: adminId,
      type: "instituteAdmin",
      instituteId: docRef.id,
      email,
      createdAt: serverTimestamp()
    });

    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø¨Ù†Ø¬Ø§Ø­!");
    instituteName.value = "";
    adminEmail.value = "";
    adminPassword.value = "";
    logoFile.value = "";
    loadInstitutes();
  }catch(err){
    console.error(err);
    errorMsg.textContent="Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯.";
  }finally{
    createBtn.disabled = false;
    createBtn.textContent = "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯";
  }
});
</script>

</body>
</html>