<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… - OMA</title>
<style>
body {
  font-family: 'Cairo', sans-serif;
  background: #f5f9ff;
  text-align: center;
  padding: 40px;
  color: #004aad;
}
button {
  padding: 12px 25px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  margin: 10px;
  cursor: pointer;
  transition: 0.3s;
}
#initBtn { background: #004aad; color: white; }
#initBtn:hover { background: #003a8c; }
#resetBtn { background: #e63946; color: white; }
#resetBtn:hover { background: #c1121f; }
#log {
  margin-top: 20px;
  white-space: pre-wrap;
  text-align: right;
  background: #fff;
  border-radius: 10px;
  padding: 20px;
  max-width: 600px;
  margin: auto;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
</style>
</head>
<body>
<h2>ğŸ”§ ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… OMA</h2>
<p>Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙŠ ØªØ±ØºØ¨ Ø¨Ù‡Ø§:</p>
<button id="initBtn">Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©</button>
<button id="resetBtn">âš ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</button>
<div id="log"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, deleteUser, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, doc, setDoc, collection, getDocs, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAMANgdrLgoGIjqLZOcS_qyEqCUOVC7gOU",
  authDomain: "oma0-33cc0.firebaseapp.com",
  projectId: "oma0-33cc0",
  storageBucket: "oma0-33cc0.firebasestorage.app",
  messagingSenderId: "899300774863",
  appId: "1:899300774863:web:0a81a7f5747ef37d49b8ba",
  measurementId: "G-5CKWYQT9XZ"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const log = document.getElementById("log");
function write(msg){ log.innerHTML += `âœ… ${msg}\n`; }

async function initializeSystem(){
  write("ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...");

  const emailAdmin = "Salahalkaleefa@gmail.com";
  const passwordAdmin = "123456salah";
  const emailManager = "demo@oma.edu";
  const passwordManager = "123456demo";

  try {
    // Ø¥Ù†Ø´Ø§Ø¡ superAdmin
    const superAdmin = await createUserWithEmailAndPassword(auth, emailAdmin, passwordAdmin);
    await setDoc(doc(db,"users",superAdmin.user.uid),{
      name:"Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…",
      email:emailAdmin,
      type:"superAdmin",
      createdAt:serverTimestamp()
    });
    write("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… superAdmin.");

    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ù‡Ø¯ ØªØ¬Ø±ÙŠØ¨ÙŠ
    const instituteId = "demo-institute";
    await setDoc(doc(db,"institutes",instituteId),{
      name:"Ù…Ø¹Ù‡Ø¯ OMA Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ",
      email:"oma-demo@oma.edu",
      logo:"https://i.ibb.co/vqC4ZP6/institute-logo.png",
      colors:{
        primary:"#004aad",
        accent:"#ffcc33",
        background:"#f5f9ff"
      },
      plan:{ type:"ØªØ¬Ø±ÙŠØ¨ÙŠ", expiresAt:"Ù…Ø¯Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©" },
      createdAt:serverTimestamp(),
      createdBy:superAdmin.user.uid
    });
    write("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ.");

    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯
    const manager = await createUserWithEmailAndPassword(auth, emailManager, passwordManager);
    await setDoc(doc(db,"users",manager.user.uid),{
      name:"Ù…Ø¯ÙŠØ± Ù…Ø¹Ù‡Ø¯ OMA Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ",
      email:emailManager,
      type:"instituteAdmin",
      instituteId:instituteId,
      createdAt:serverTimestamp()
    });
    write("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ.");

    await setDoc(doc(db,`institutes/${instituteId}/settings/general`),{
      openHours:"8:00 AM - 5:00 PM",
      contact:"07800000000",
      address:"Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„Ø¹Ø±Ø§Ù‚",
      updatedAt:serverTimestamp()
    });
    write("ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©.");

    write("ğŸ‰ ØªÙ…Øª Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¨Ù†Ø¬Ø§Ø­!\nÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:");
    write("ğŸ”¹ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…: " + emailAdmin + " / " + passwordAdmin);
    write("ğŸ”¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù‡Ø¯: " + emailManager + " / " + passwordManager);
  } catch (err) {
    write("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message);
  }
}

async function resetSystem(){
  if(!confirm("âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹!")) return;
  log.innerHTML = "ğŸ§¹ Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...\n";

  try {
    // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Firestore
    const collections = ["users", "institutes"];
    for(const col of collections){
      const snapshot = await getDocs(collection(db, col));
      for(const docSnap of snapshot.docs){
        await deleteDoc(docSnap.ref);
      }
      write(`ØªÙ… Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø© ${col}.`);
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø¹Ø¨Ø± Ø§Ù„ÙˆÙŠØ¨ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„ÙƒÙ† Ù†Ø·Ø¨Ø¹ ÙÙ‚Ø· Ù„Ù„ØªÙˆØ«ÙŠÙ‚)
    write("ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Firebase Auth Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©.");
    write("âš ï¸ Ø§Ø­Ø°ÙÙ‡Ù… ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø³Ù… Authentication ÙÙŠ Firebase Console Ø¥Ù† Ø±ØºØ¨Øª.");

    write("â™»ï¸ Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ (Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©) Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ø¬Ø¯ÙŠØ¯.");
  } catch (err) {
    write("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + err.message);
  }
}

document.getElementById("initBtn").addEventListener("click", initializeSystem);
document.getElementById("resetBtn").addEventListener("click", resetSystem);
</script>
</body>
</html>