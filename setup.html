<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช - OMA</title>
<style>
body {
  font-family: 'Cairo', sans-serif;
  background: #f5f9ff;
  color: #102027;
  padding: 30px;
  direction: rtl;
}
.card {
  background: #fff;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}
button {
  background: #004aad;
  color: #fff;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}
button:hover { background: #003a8c; }
pre {
  background: #eef4ff;
  padding: 10px;
  border-radius: 8px;
  overflow-x: auto;
  white-space: pre-wrap;
}
</style>
</head>
<body>

<h2>๐ง ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุจูุงูุงุช OMA (Firestore)</h2>
<p>ุนูุฏ ุงูุถุบุท ุนูู ุงูุฒุฑ ุจุงูุฃุณููุ ุณูุชู ุฅูุดุงุก ุงููุฌููุนุงุช ุงูุฃุณุงุณูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.</p>

<div class="card">
  <button id="setupBtn">๐ ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</button>
  <pre id="log"></pre>
</div>

<script type="module">
import { db } from "https://salahmam.github.io/OMA/firebase-config.js";
import { setDoc, doc, getDocs, collection } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const log = document.getElementById("log");
const setupBtn = document.getElementById("setupBtn");

function addLog(msg){ 
  log.textContent += msg + "\n"; 
  log.scrollTop = log.scrollHeight;
}

async function checkFirebaseConnection() {
  addLog("โณ ุงูุชุญูู ูู ุงูุงุชุตุงู ุจู Firebase...");
  try {
    await getDocs(collection(db, "settings"));
    addLog("โ ุชู ุงูุงุชุตุงู ุจูุฌุงุญ ุจู Firestore.\n");
    return true;
  } catch (error) {
    addLog("โ ูุดู ุงูุงุชุตุงู ุจู Firestore: " + error.message);
    setupBtn.disabled = true;
    setupBtn.style.background = "#d32f2f";
    return false;
  }
}

setupBtn.addEventListener("click", async ()=>{
  const connected = await checkFirebaseConnection();
  if (!connected) return;

  setupBtn.disabled = true;
  setupBtn.textContent = "โณ ุฌุงุฑู ุงูุชูููุฐ...";
  addLog("๐น ุจุฏุก ุฅูุดุงุก ุงููุฌููุนุงุช ุงูุฃุณุงุณูุฉ...\n");

  try {
    // ๐ Collection: students
    await setDoc(doc(db, "students", "example_student"), {
      name: "ุฃุญูุฏ ุนูู",
      address: "ุจุบุฏุงุฏ",
      phone: "0770000000",
      level: "ุงููุฑุญูุฉ ุงูุฃููู",
      group: "A1",
      subjects: ["ุฑูุงุถูุงุช", "ุนููู"],
      joinDate: "2025-11-07",
      fees: 500000,
      installments: [250000, 250000],
      status: "ูุดุท"
    });
    addLog("โ students collection ุชู ุฅูุดุงุคู.");

    // ๐ Collection: teachers
    await setDoc(doc(db, "teachers", "example_teacher"), {
      name: "ุฃุณุชุงุฐ ูุฑูู",
      specialty: "ุฑูุงุถูุงุช",
      phone: "0780000000",
      salary: 800000,
      percent: 60,
      joinDate: "2025-11-07",
      address: "ุงูุจุตุฑุฉ",
      status: "ูุดุท"
    });
    addLog("โ teachers collection ุชู ุฅูุดุงุคู.");

    // ๐ Collection: users
    await setDoc(doc(db, "users", "admin_sample"), {
      name: "ูุฏูุฑ ุงููุธุงู",
      email: "admin@oma.com",
      type: "admin",
      createdAt: new Date().toISOString()
    });
    addLog("โ users collection ุชู ุฅูุดุงุคู.");

    // ๐ Collection: settings
    await setDoc(doc(db, "settings", "percentages"), {
      teacher: 60,
      institute: 40
    });
    addLog("โ settings collection ุชู ุฅูุดุงุคู.");

    addLog("\n๐ ุชู ุฅูุดุงุก ุฌููุน ุงููุฌููุนุงุช ุจูุฌุงุญ!");
    setupBtn.textContent = "โ ุชู ุงูุฅูุดุงุก ุจูุฌุงุญ";
    setupBtn.style.background = "#00b67a";

    // โณ ุงูุงูุชูุงู ุจุนุฏ 3 ุซูุงูู
    addLog("\nโก๏ธ ุณูุชู ุชุญูููู ุฅูู ููุญุฉ ุงูุชุญูู ุฎูุงู 3 ุซูุงูู...");
    setTimeout(()=>{
      window.location.href = "dashboard.html";
    }, 3000);

  } catch (e) {
    addLog("โ ุฎุทุฃ ุฃุซูุงุก ุงูุฅูุดุงุก: " + e.message);
    setupBtn.disabled = false;
    setupBtn.textContent = "๐ ุฅุนุงุฏุฉ ุงููุญุงููุฉ";
  }
});

// ุงูุชุญูู ูู ุงูุงุชุตุงู ูุจุงุดุฑุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
checkFirebaseConnection();
</script>

</body>
</html>